<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ’£ Ø¹Ø§Ù…Ù„ Ø§Ù„Ù…Ù†Ø¬Ù… - Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª</title>
<script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.min.js"></script>
<style>
  body {
    margin: 0;
    font-family: "Cairo", sans-serif;
    background: #1b0e05;
    color: white;
    text-align: center;
  }
  #game { width: 100%; height: 100vh; }
</style>
</head>
<body>
<h2>ğŸ® Ø¹Ø§Ù…Ù„ Ø§Ù„Ù…Ù†Ø¬Ù… ğŸšƒ</h2>
<div id="game"></div>

<script>
/* Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø´Ù‡Ø¯Ø§Øª */
const LevelMapScene = { key: 'LevelMapScene', preload: preloadMap, create: createMap };
const GameScene = { key: 'GameScene', preload: preloadGame, create: createGame, update: updateGame };
const ShopScene = { key: 'ShopScene', create: createShop };

const config = {
  type: Phaser.AUTO,
  width: 800,
  height: 600,
  parent: 'game',
  physics: { default: 'arcade', arcade: { gravity: { y: 200 }, debug: false } },
  scene: [LevelMapScene, GameScene, ShopScene]
};
const game = new Phaser.Game(config);

let cart, cursors, rocks, projectiles, scoreText, coinText, glowEffect;
let score = 0, coins = 0, level = 1, stage = 1;
let weaponType = 'pickaxe', rockSpeed = 200, fireRate = 1, moneyBoost = 1;
let lastFire = 0;

/* Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª */
const saved = JSON.parse(localStorage.getItem('minerData') || '{}');
if (saved.coins) coins = saved.coins;
if (saved.level) level = saved.level;
if (saved.stage) stage = saved.stage;
if (saved.fireRate) fireRate = saved.fireRate;
if (saved.moneyBoost) moneyBoost = saved.moneyBoost;

/* ==================== Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª ==================== */
function preloadMap() {
  this.load.image('map', 'images/map.png');
  this.load.image('levelIcon', 'images/level.png');
}
function createMap() {
  // Ø§Ù„Ø®Ù„ÙÙŠØ©
  this.add.image(400, 300, 'map').setScale(1.05);

  // Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø®Ø±ÙŠØ·Ø©
  this.add.text(400, 70, 'ğŸ”ï¸ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª', {
    fontSize: '26px',
    fill: '#ffffff',
    fontStyle: 'bold'
  }).setOrigin(0.5);

  // ØªÙˆÙ„ÙŠØ¯ Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
  for (let i = 1; i <= 5; i++) {
    const x = 140 * i; // ØªÙˆØ²ÙŠØ¹ Ø£ÙÙ‚ÙŠ Ù…ØªÙ†Ø§Ø³Ù‚
    const y = 300 + Phaser.Math.Between(-40, 40); // Ø§Ø®ØªÙ„Ø§Ù Ø¨Ø³ÙŠØ· Ø¨Ø§Ù„Ø§Ø±ØªÙØ§Ø¹

    // Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ø³ØªÙˆÙ‰
    const icon = this.add.image(x, y, 'levelIcon')
      .setScale(0.45) // âœ… ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 0.8 Ø¥Ù„Ù‰ 0.45
      .setInteractive({ useHandCursor: true });

    // Ø§Ù„Ù„ÙˆÙ†: Ù…ÙØªÙˆØ­ Ø£Ù… Ù…ØºÙ„Ù‚
    icon.setTint(i <= level ? 0x00ff88 : 0x555555);

    // Ù†Øµ ØªØ­Øª Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©
    this.add.text(x, y + 40, 'Ù…Ø±Ø­Ù„Ø© ' + i, {
      fontSize: '16px',
      fill: '#ffffff',
      fontStyle: 'bold'
    }).setOrigin(0.5);

    // Ù…Ø³ØªÙˆÙ‰ Ù…ØªØ§Ø­ ÙÙ‚Ø·
    if (i <= level) {
      // ğŸ’« ØªØ£Ø«ÙŠØ± Ø¨Ø³ÙŠØ· Ù„Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ
      if (i === level) {
        this.tweens.add({
          targets: icon,
          alpha: { from: 0.6, to: 1 },
          duration: 800,
          yoyo: true,
          repeat: -1
        });
      }

      // Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ·
      icon.on('pointerdown', () => {
        stage = i;
        this.scene.start('GameScene');
      });
    }
  }
}


/* ==================== Ù…Ø´Ù‡Ø¯ Ø§Ù„Ù„Ø¹Ø¨Ø© ==================== */
function preloadGame() {
  this.load.image('background', 'images/background.png');
  this.load.image('cart', 'images/cart.png');
  this.load.image('rock', 'images/rock.png');
  this.load.image('pickaxe', 'images/pickaxe.png');
  this.load.image('dynamite', 'images/dynamite.png');
  this.load.image('explosion', 'images/explosion.png');
  this.load.image('coin', 'images/coin.png');
  this.load.image('glow', 'images/glow.png');
  this.load.audio('throw', 'sounds/throw.mp3');
  this.load.audio('hit', 'sounds/hit.mp3');
  this.load.audio('coin', 'sounds/coin.mp3');
  this.load.audio('explosionSound', 'sounds/explosion.mp3');
}
function createGame() {
  // Ø§Ù„Ø®Ù„ÙÙŠØ©
  this.add.image(400, 300, 'background').setScale(0.85);

  // ğŸšƒ Ø§Ù„Ø¹Ø±Ø¨Ø© (Ø£ØµØºØ± Ø­Ø¬Ù…)
  cart = this.physics.add.sprite(400, 520, 'cart').setScale(0.35);
  cart.setCollideWorldBounds(true);

  // Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª
  rocks = this.physics.add.group();
  projectiles = this.physics.add.group();
  cursors = this.input.keyboard.createCursorKeys();

  // Ø§Ù„Ù†ØµÙˆØµ
  scoreText = this.add.text(16, 16, 'Ø§Ù„Ù†Ù‚Ø§Ø·: 0', { fontSize: '18px', fill: '#fff' });
  coinText = this.add.text(16, 40, 'Ø§Ù„Ø¹Ù…Ù„Ø§Øª: ' + coins, { fontSize: '18px', fill: '#ffd700' });

  // Ø§Ù„Ø£ØµÙˆØ§Øª
  this.throwSound = this.sound.add('throw');
  this.hitSound = this.sound.add('hit');
  this.coinSound = this.sound.add('coin');
  this.explosionSound = this.sound.add('explosionSound');

  // Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ğŸŸ¢
  const startText = this.add.text(400, 300, 'Ø§Ø¶ØºØ· Ù„Ù„Ø¨Ø¯Ø¡', {
    fontSize: '30px',
    fill: '#00ff00',
  }).setOrigin(0.5);

  // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· ØªØ¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©
  this.input.once('pointerdown', () => {
    startText.destroy();
    startGame.call(this);
  });
}

// Ø¯Ø§Ù„Ø© Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
function startGame() {
  this.input.on('pointerdown', () => shootProjectile.call(this));
  this.physics.add.collider(projectiles, rocks, hitRock, null, this);

  // Ø§Ù„ØµØ®ÙˆØ± ğŸª¨
  this.time.addEvent({
    delay: 1800,
    callback: spawnRock,
    callbackScope: this,
    loop: true
  });

  // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø£Ø³Ù„Ø­Ø© ğŸ’£ğŸª“
  this.time.addEvent({
    delay: 7000,
    callback: switchWeapon,
    callbackScope: this,
    loop: true
  });

  score = 0;
}

// Ø¯Ø§Ù„Ø© Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
function startGame() {
  this.input.on('pointerdown', () => shootProjectile.call(this));
  this.physics.add.collider(projectiles, rocks, hitRock, null, this);

  // ØªØ£Ø®ÙŠØ± Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù‚Ù„ÙŠÙ„Ø§Ù‹
  this.time.addEvent({
    delay: 1000,
    callback: () => {
      this.time.addEvent({ delay: 1800, callback: spawnRock, callbackScope: this, loop: true });
    },
    callbackScope: this
  });

  this.time.addEvent({ delay: 8000, callback: switchWeapon, callbackScope: this, loop: true });

  score = 0;
}

function updateGame() {
  cart.setVelocityX(0);
  if (cursors.left.isDown) cart.setVelocityX(-250);
  else if (cursors.right.isDown) cart.setVelocityX(250);

  rocks.children.iterate(rock => {
    if (!rock) return;
    if (rock.y > 580) rock.setVelocityY(-Phaser.Math.Between(rockSpeed * 0.6, rockSpeed));
    if (rock.y < 20) rock.setVelocityY(Phaser.Math.Between(rockSpeed * 0.5, rockSpeed));
  });
  if (glowEffect) { glowEffect.x = cart.x; glowEffect.y = cart.y; }
}
function spawnRock() {
  const x = Phaser.Math.Between(50, 750);
  const rock = rocks.create(x, 0, 'rock').setScale(0.35);
  rock.setVelocity(Phaser.Math.Between(-40, 40), Phaser.Math.Between(120, 180));
  rock.setBounce(1);
  rock.setCollideWorldBounds(true);
}

function shootProjectile() {
  const now = Date.now();
  if (now - lastFire < 1000 / fireRate) return;
  lastFire = now;
  this.throwSound.play({ volume: 0.2 });
  const projectile = projectiles.create(cart.x, cart.y - 30, weaponType).setScale(0.6);
  projectile.setVelocityY(-400);
}
function hitRock(projectile, rock) {
  this.hitSound.play({ volume: 0.3 });
  createExplosion.call(this, rock.x, rock.y);
  projectile.destroy(); rock.destroy();
  score += (weaponType === 'pickaxe' ? 10 : 20);
  coins += Math.floor(5 * moneyBoost);
  scoreText.setText('Ø§Ù„Ù†Ù‚Ø§Ø·: ' + score);
  coinText.setText('Ø§Ù„Ø¹Ù…Ù„Ø§Øª: ' + coins);
  this.coinSound.play({ volume: 0.3 });
  createCoinEffect.call(this, rock.x, rock.y);
  glowAroundCart.call(this);
  saveData();
  if (score >= 100) this.scene.start('ShopScene');
}
function createExplosion(x, y) {
  const explosion = this.add.sprite(x, y, 'explosion').setScale(0.8);
  const color = weaponType === 'dynamite' ? 0xff6600 : 0xffffcc;
  explosion.setTint(color);
  if (weaponType === 'dynamite') this.explosionSound.play({ volume: 0.5 });
  this.cameras.main.shake(150, 0.02);
  this.tweens.add({ targets: explosion, alpha: 0, scale: 1.5, duration: 400, onComplete: () => explosion.destroy() });
  if (weaponType === 'dynamite') {
    const colors = [0xff4400, 0xffa500, 0xffff00];
    const flashColor = Phaser.Utils.Array.GetRandom(colors);
    const flash = this.add.rectangle(400, 300, 800, 600, flashColor, 0.4);
    this.tweens.add({ targets: flash, alpha: 0, duration: 300, ease: 'Cubic.easeOut', onComplete: () => flash.destroy() });
  }
}
function createCoinEffect(x, y) {
  const coin = this.add.sprite(x, y, 'coin').setScale(0.5);
  this.tweens.add({ targets: coin, y: y - 50, alpha: 0, duration: 600, onComplete: () => coin.destroy() });
}
function glowAroundCart() {
  if (glowEffect) glowEffect.destroy();
  glowEffect = game.scene.keys.GameScene.add.sprite(cart.x, cart.y, 'glow').setScale(1.5).setAlpha(0.8);
  glowEffect.setBlendMode(Phaser.BlendModes.ADD);
  game.scene.keys.GameScene.tweens.add({
    targets: glowEffect, alpha: 0, scale: 2, duration: 600,
    ease: 'Cubic.easeOut', onComplete: () => { glowEffect.destroy(); glowEffect = null; }
  });
}
function switchWeapon() { weaponType = weaponType === 'pickaxe' ? 'dynamite' : 'pickaxe'; }

/* ==================== Ù…Ø´Ù‡Ø¯ Ø§Ù„Ù…ØªØ¬Ø± ==================== */
function createShop() {
  const shopBg = this.add.rectangle(400, 300, 600, 400, 0x000000, 0.85);
  this.add.text(400, 180, 'ğŸª Ø§Ù„Ù…ØªØ¬Ø± - Ø§Ù„Ù…Ø±Ø­Ù„Ø© ' + stage, { fontSize: '28px', fill: '#fff' }).setOrigin(0.5);
  const upgradeFire = this.add.text(400, 260, 'âš¡ Ø²ÙŠØ§Ø¯Ø© Ø³Ø±Ø¹Ø© Ø§Ù„Ø¶Ø±Ø¨: 50 Ø¹Ù…Ù„Ø©', { fontSize: '22px', fill: '#ffd700' }).setOrigin(0.5).setInteractive();
  const upgradeMoney = this.add.text(400, 320, 'ğŸ’° Ù…Ø¶Ø§Ø¹ÙØ© Ø§Ù„Ù†Ù‚ÙˆØ¯: 70 Ø¹Ù…Ù„Ø©', { fontSize: '22px', fill: '#ffd700' }).setOrigin(0.5).setInteractive();
  const continueBtn = this.add.text(400, 400, 'Ø§Ø³ØªÙ…Ø±Ø§Ø± â–¶ï¸', { fontSize: '24px', fill: '#00ff00' }).setOrigin(0.5).setInteractive();

  upgradeFire.on('pointerdown', () => { if (coins >= 50) { coins -= 50; fireRate += 0.5; saveData(); } });
  upgradeMoney.on('pointerdown', () => { if (coins >= 70) { coins -= 70; moneyBoost += 0.5; saveData(); } });
  continueBtn.on('pointerdown', () => {
    stage++;
    if (stage > level) level++;
    saveData();
    this.scene.start('LevelMapScene');
  });
}

/* ==================== Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ==================== */
function saveData() {
  localStorage.setItem('minerData', JSON.stringify({ coins, level, stage, fireRate, moneyBoost }));
}
</script>
</body>
</html>



